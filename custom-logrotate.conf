# Custom logrotate configuration
# Place this file in: /etc/logrotate.d/custom-logs

/var/log/custom/*.log {
    # Rotate daily
    daily
    
    # Keep 30 days of logs
    rotate 30
    
    # Compress old logs (except the most recent)
    compress
    delaycompress
    
    # Don't rotate if log is empty
    notifempty
    
    # Create new log files with specific permissions
    create 0644 syslog adm
    
    # Use date as suffix for rotated logs
    dateext
    dateformat -%Y%m%d
    
    # Don't mail old log files
    nomail
    
    # Handle missing log files gracefully
    missingok
    
    # Rotate even if multiple files match pattern
    sharedscripts
    
    # Commands to run after rotation
    postrotate
        # Reload rsyslog to recognize new log files
        /bin/kill -HUP `cat /var/run/rsyslogd.pid 2> /dev/null` 2> /dev/null || true
        
        # Optional: restart any custom applications that might have file handles open
        # systemctl reload custom-app 2> /dev/null || true
    endscript
}

# Specific configuration for high-traffic access logs
/var/log/custom/access.log {
    # Rotate hourly for high-traffic logs
    hourly
    
    # Keep 7 days worth of hourly logs (168 files)
    rotate 168
    
    compress
    delaycompress
    notifempty
    create 0644 syslog adm
    dateext
    dateformat -%Y%m%d-%H
    nomail
    missingok
    
    postrotate
        /bin/kill -HUP `cat /var/run/rsyslogd.pid 2> /dev/null` 2> /dev/null || true
    endscript
}