# Custom rsyslog configuration for centralized logging
# Place this file in: /etc/rsyslog.d/50-custom.conf

# Enable modules for file watching and JSON formatting
module(load="imfile")
module(load="mmjsonparse")

# Custom log format with timestamp, hostname, facility, severity, and message
$template CustomLogFormat,"%timestamp:::date-rfc3339% %hostname% %syslogfacility-text%.%syslogseverity-text% %programname%[%procid%]: %msg%\n"

# Application logs directory
$WorkDirectory /var/spool/rsyslog
$CreateDirs on

# Custom application logs
# Monitor custom application log files
input(type="imfile"
      File="/var/log/custom/app.log"
      Tag="custom-app"
      Severity="info"
      Facility="local0")

input(type="imfile"
      File="/var/log/custom/error.log"
      Tag="custom-error"
      Severity="error"
      Facility="local1")

input(type="imfile"
      File="/var/log/custom/access.log"
      Tag="custom-access"
      Severity="info"
      Facility="local2")

# Send all custom logs to a centralized file
local0.*    /var/log/custom/combined.log;CustomLogFormat
local1.*    /var/log/custom/combined.log;CustomLogFormat
local2.*    /var/log/custom/combined.log;CustomLogFormat

# System logs with custom format
auth,authpriv.*     /var/log/custom/auth.log;CustomLogFormat
*.*;auth,authpriv.none,local0.none,local1.none,local2.none    /var/log/custom/system.log;CustomLogFormat

# Emergency messages to all users
*.emerg             :omusrmsg:*

# Stop processing after writing to custom logs to avoid duplication
local0.* stop
local1.* stop
local2.* stop